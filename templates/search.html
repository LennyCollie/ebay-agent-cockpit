extends "base.html" %}
{% block title %}Suche â€“ ebay-agent-cockpit{% endblock %}
{% block content %}
<h1 class="mb-3">eBayâ€‘Suche</h1>
<form method="post" action="{{ url_for('search_post') }}" class="row gy-2">
  <div class="col-12 col-md-6"><input name="term1" class="form-control" placeholder="Suchbegriff 1" required></div>
  <div class="col-12 col-md-6"><input name="term2" class="form-control" placeholder="Suchbegriff 2"></div>
  <div class="col-12 col-md-6"><input name="term3" class="form-control" placeholder="Suchbegriff 3"></div>

  <!-- Premium (optional mehr Felder; unsichtbar stÃ¶ren sie nicht) -->
  <div class="col-12 col-md-6"><input name="term4" class="form-control" placeholder="(Premium) Suchbegriff 4"></div>
  <div class="col-12 col-md-6"><input name="term5" class="form-control" placeholder="(Premium) Suchbegriff 5"></div>

  <div class="col-12">
    <button class="btn btn-primary mt-2">Suchen</button>
  </div>
</form>
{% if not is_premium %}
<p class="text-muted small mt-3">Im kostenlosen Plan werden max. 3 Begriffe verarbeitet.</p>
{% endif %}
{% endblock %}

{% block content %}
<h1 class="mb-3">eBayâ€‘Suche</h1>

<div class="alert alert-info">
  {% if is_premium %}
    Premium: bis zu {{ max_terms }} Suchbegriffe pro Anfrage, bis {{ per_query_limit }} Ergebnisse je Begriff.
  {% else %}
    Kostenlos: bis zu {{ max_terms }} Suchbegriffe pro Anfrage. <a href="{{ url_for('public_pricing') }}">Upgrade</a> fÃ¼r mehr.
  {% endif %}
</div>

<form method="post" class="card shadow-sm border-0 mb-4">
  <div class="card-body">
    <div id="q-list" class="vstack gap-2">
      {% set current = q_list if q_list else ['','',''] %}
      {% for q in current %}
        <div class="input-group">
          <span class="input-group-text">ðŸ”Ž</span>
          <input name="q[]" type="text" class="form-control" placeholder="Suchbegriff"
                 value="{{ q }}" maxlength="120">
        </div>
      {% endfor %}
    </div>

    <div class="d-flex gap-2 mt-3">
      <button class="btn btn-primary" type="submit">Suchen</button>
      <button id="addInput" class="btn btn-outline-secondary" type="button">Feld hinzufÃ¼gen</button>
    </div>
    <div class="form-text mt-2">Max. {{ max_terms }} Suchfelder in deiner Stufe.</div>
  </div>
</form>

{% if results %}
  <h2 class="h5 mb-3">Ergebnisse</h2>
  {% for q, items in results.items() %}
    <div class="mb-4">
      <h3 class="h6 mb-2">ðŸ”Ž {{ q }}</h3>
      {% if items %}
        <div class="row g-3">
          {% for it in items %}
            <div class="col-12 col-md-6 col-lg-4">
              <div class="card h-100">
                {% if it.image %}
                  <img src="{{ it.image }}" class="card-img-top" alt="">
                {% endif %}
                <div class="card-body">
                  <div class="card-title h6">{{ it.title }}</div>
                  {% if it.price %}<div class="text-secondary mb-2">{{ it.price }}</div>{% endif %}
                  {% if it.url %}
                    <a class="btn btn-sm btn-outline-primary" href="{{ it.url }}" target="_blank" rel="noopener">Ansehen</a>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-secondary">Keine Treffer.</div>
      {% endif %}
    </div>
  {% endfor %}
{% endif %}
{% endblock %}

{% block body_extra %}
<script>
  (function(){
    const maxTerms = {{ max_terms }};
    const btn = document.getElementById('addInput');
    const list = document.getElementById('q-list');
    btn?.addEventListener('click', function(){
      const fields = list.querySelectorAll('input[name="q[]"]');
      if (fields.length >= maxTerms) {
        alert('Maximale Anzahl erreicht: ' + maxTerms);
        return;
      }
      const wrap = document.createElement('div');
      wrap.className = 'input-group mt-2';
      wrap.innerHTML = `
        <span class="input-group-text">ðŸ”Ž</span>
        <input name="q[]" type="text" class="form-control" placeholder="Suchbegriff" maxlength="120">
      `;
      list.appendChild(wrap);
    });
  })();
</script>
{% endblock %}