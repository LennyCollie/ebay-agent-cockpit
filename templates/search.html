{% extends "base.html" %}
{% block title %}Suche – ebay-agent-cockpit{% endblock %}

{% block content %}
<h1 class="h3 mb-3">Artikel suchen</h1>
<p class="text-secondary">Bis zu drei Begriffe gleichzeitig. Optional mit Filtern verfeinern.</p>

<form method="post" action="{{ url_for('search') }}" class="vstack gap-4">

  <!-- Suchbegriffe -->
  <div class="row g-3">
    <div class="col-md-4">
      <label for="q1" class="form-label">Suchbegriff 1</label>
      <input type="text" id="q1" name="q1" class="form-control"
             value="{{ request.form.get('q1','') }}" placeholder="z. B. iPhone 11">
    </div>
    <div class="col-md-4">
      <label for="q2" class="form-label">Suchbegriff 2 (optional)</label>
      <input type="text" id="q2" name="q2" class="form-control"
             value="{{ request.form.get('q2','') }}" placeholder="z. B. Lautsprecher">
    </div>
    <div class="col-md-4">
      <label for="q3" class="form-label">Suchbegriff 3 (optional)</label>
      <input type="text" id="q3" name="q3" class="form-control"
             value="{{ request.form.get('q3','') }}" placeholder="z. B. iPhone 8">
    </div>
  </div>

  <!-- Erweiterte Filter -->
  {% set selected_conditions = request.form.getlist('condition') %}
  {% set sel_sort = request.form.get('sort','best') %}
  <div class="card border-0 shadow-sm">
    <div class="card-body">
      <div class="d-flex align-items-center justify-content-between">
        <h2 class="h6 mb-0">Erweiterte Filter</h2>
      </div>

      <div class="row g-3 mt-1">
        <!-- Preisbereich -->
        <div class="col-6 col-md-3">
          <label class="form-label">Min. Preis</label>
          <div class="input-group">
            <span class="input-group-text">€</span>
            <input type="number" step="0.01" min="0" inputmode="decimal"
                   class="form-control" name="price_min"
                   value="{{ request.form.get('price_min','') }}"
                   placeholder="z. B. 50">
          </div>
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label">Max. Preis</label>
          <div class="input-group">
            <span class="input-group-text">€</span>
            <input type="number" step="0.01" min="0" inputmode="decimal"
                   class="form-control" name="price_max"
                   value="{{ request.form.get('price_max','') }}"
                   placeholder="z. B. 500">
          </div>
        </div>

        <!-- Sortierung -->
        <div class="col-md-3">
          <label class="form-label">Sortierung</label>
          <select class="form-select" name="sort">
            <option value="best"        {{ 'selected' if sel_sort=='best' else '' }}>Best Match (Standard)</option>
            <option value="price_asc"   {{ 'selected' if sel_sort=='price_asc' else '' }}>Preis ↑ (günstig zuerst)</option>
            <option value="price_desc"  {{ 'selected' if sel_sort=='price_desc' else '' }}>Preis ↓ (teuer zuerst)</option>
            <option value="newly"       {{ 'selected' if sel_sort=='newly' else '' }}>Neu eingestellt</option>
          </select>
        </div>
      </div>

      <!-- Zustände -->
      <div class="mt-3">
        <label class="form-label d-block mb-1">Zustand</label>
        <div class="d-flex flex-wrap gap-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="condNEW" name="condition" value="NEW"
                   {{ 'checked' if 'NEW' in selected_conditions else '' }}>
            <label class="form-check-label" for="condNEW">Neu</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="condUSED" name="condition" value="USED"
                   {{ 'checked' if 'USED' in selected_conditions else '' }}>
            <label class="form-check-label" for="condUSED">Gebraucht</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="condOPEN" name="condition" value="OPEN_BOX"
                   {{ 'checked' if 'OPEN_BOX' in selected_conditions else '' }}>
            <label class="form-check-label" for="condOPEN">Geöffnet/OVP</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="condREF" name="condition" value="SELLER_REFURBISHED"
                   {{ 'checked' if 'SELLER_REFURBISHED' in selected_conditions else '' }}>
            <label class="form-check-label" for="condREF">Generalüberholt (Händler)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="condCERT" name="condition" value="CERTIFIED_REFURBISHED"
                   {{ 'checked' if 'CERTIFIED_REFURBISHED' in selected_conditions else '' }}>
            <label class="form-check-label" for="condCERT">Zertifiziert überholt</label>
          </div>
        </div>
        <div class="form-text">Mehrere Zustände kombinierbar. Leer = alle.</div>
      </div>
    </div>
  </div>

  <!-- Aktionen -->
  <div class="d-flex gap-2">
    <button type="submit" class="btn btn-primary">Suchen</button>
    <a href="{{ url_for('search') }}" class="btn btn-outline-secondary">Zurücksetzen</a>
  </div>
</form>
{% endblock %}