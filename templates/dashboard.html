{% extends "base.html" %} {% block content %}

<style>
  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 24px;
    margin: 24px 0;
  }

  .dashboard-card {
    background: white;
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    border: 1px solid #e5e7eb;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .dashboard-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  }

  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
  }

  .card-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1f2937;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .card-icon {
    font-size: 1.5rem;
  }

  .card-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: #111827;
    margin: 8px 0;
  }

  .card-subtitle {
    font-size: 0.9rem;
    color: #6b7280;
  }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .status-success {
    background: #d1fae5;
    color: #065f46;
  }

  .status-warning {
    background: #fef3c7;
    color: #92400e;
  }

  .status-danger {
    background: #fee2e2;
    color: #991b1b;
  }

  .progress-bar {
    width: 100%;
    height: 8px;
    background: #e5e7eb;
    border-radius: 4px;
    overflow: hidden;
    margin: 12px 0;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6, #8b5cf6);
    transition: width 0.3s ease;
  }

  .quick-action {
    display: block;
    width: 100%;
    padding: 12px;
    margin-top: 16px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    background: white;
    color: #374151;
    font-weight: 600;
    text-align: center;
    text-decoration: none;
    transition: all 0.2s;
  }

  .quick-action:hover {
    border-color: #3b82f6;
    background: #eff6ff;
    color: #1e40af;
    text-decoration: none;
  }

  .quick-action-primary {
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    color: white;
    border: none;
  }

  .quick-action-primary:hover {
    background: linear-gradient(135deg, #2563eb, #7c3aed);
    color: white;
    transform: scale(1.02);
  }

  .alert-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px;
    background: #f9fafb;
    border-radius: 8px;
    margin-bottom: 8px;
  }

  .alert-term {
    font-weight: 600;
    color: #111827;
  }

  .alert-price {
    font-size: 0.9rem;
    color: #6b7280;
  }

  .notification-item {
    display: flex;
    align-items: start;
    gap: 12px;
    padding: 12px;
    background: #f0f9ff;
    border-left: 3px solid #3b82f6;
    border-radius: 8px;
    margin-bottom: 8px;
  }

  .notification-time {
    font-size: 0.85rem;
    color: #6b7280;
  }

  .upgrade-banner {
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    color: white;
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    margin: 24px 0;
  }

  .upgrade-banner h3 {
    margin: 0 0 8px 0;
    color: white;
  }

  .upgrade-banner p {
    margin: 0 0 16px 0;
    opacity: 0.9;
  }

  .btn-upgrade {
    background: white;
    color: #f59e0b;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    display: inline-block;
    transition: transform 0.2s;
  }

  .btn-upgrade:hover {
    transform: scale(1.05);
    text-decoration: none;
    color: #f59e0b;
  }
</style>

<div class="container py-4">
  <!-- Header -->
  <div class="mb-4">
    <h1 class="h3 mb-1">Dashboard</h1>
    <p class="text-muted">Willkommen zur√ºck, {{ user.email or 'User' }}!</p>
  </div>

  <!-- Upgrade Banner (nur f√ºr Free User) -->
  {% if stats.plan == 'free' and stats.active_alerts >= stats.max_alerts %}
  <div class="upgrade-banner">
    <h3>üöÄ Limit erreicht!</h3>
    <p>
      Du hast {{ stats.max_alerts }} von {{ stats.max_alerts }} Alerts aktiv. Upgrade f√ºr mehr
      Alerts und schnellere Benachrichtigungen!
    </p>
    <a href="/pricing" class="btn-upgrade"> Jetzt upgraden </a>
  </div>
  {% endif %}

  <!-- Main Grid -->
  <div class="dashboard-grid">
    <!-- Telegram Status -->
    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-title">
          <span class="card-icon">üì±</span>
          Telegram
        </div>
        {% if user.telegram_verified %}
        <span class="status-badge status-success">‚úì Verbunden</span>
        {% else %}
        <span class="status-badge status-danger">‚úó Nicht verbunden</span>
        {% endif %}
      </div>

      {% if user.telegram_verified %}
      <p class="card-subtitle">
        <strong>@{{ user.telegram_username or 'User' }}</strong><br />
        Du erh√§ltst Echtzeit-Benachrichtigungen!
      </p>

      {% if not user.telegram_enabled %}
      <div class="alert alert-warning mt-3" style="font-size: 0.9rem">
        ‚ö†Ô∏è Benachrichtigungen sind pausiert
      </div>
      {% endif %}

      <a href="/telegram/settings" class="quick-action"> ‚öôÔ∏è Einstellungen </a>
      {% else %}
      <p class="card-subtitle">
        Verbinde dein Telegram-Konto um Push-Benachrichtigungen zu erhalten.
      </p>
      <a href="/telegram/settings" class="quick-action quick-action-primary">
        üöÄ Jetzt verbinden
      </a>
      {% endif %}
    </div>

    <!-- Alerts -->
    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-title">
          <span class="card-icon">üîî</span>
          Aktive Alerts
        </div>
      </div>

      <div class="card-value">{{ stats.active_alerts }}</div>
      <p class="card-subtitle">von {{ stats.max_alerts }} m√∂glich</p>

      <!-- Progress Bar -->
      <div class="progress-bar">
        <div
          class="progress-fill"
          style="width: {{ (stats.active_alerts / stats.max_alerts * 100) }}%"
        ></div>
      </div>

      <p class="card-subtitle" style="margin-top: 12px">
        <strong>Plan:</strong> {{ stats.plan.title() }}<br />
        <strong>Check-Interval:</strong> Alle {{ stats.check_interval }} Minuten
      </p>

      <a href="/watchlist" class="quick-action"> üìã Watchlist ansehen </a>
    </div>

    <!-- Benachrichtigungen -->
    <div class="dashboard-card">
      <div class="card-header">
        <div class="card-title">
          <span class="card-icon">üì®</span>
          Benachrichtigungen
        </div>
      </div>

      <div class="card-value">{{ stats.notifications_today }}</div>
      <p class="card-subtitle">heute gesendet</p>

      {% if stats.notifications_today > 0 %}
      <div class="notification-item">
        <span style="font-size: 1.5rem">üéØ</span>
        <div>
          <div><strong>Neue Treffer gefunden!</strong></div>
          <div class="notification-time">Letzte vor {{ last_notification_time or '5' }} Min</div>
        </div>
      </div>
      {% else %}
      <p class="card-subtitle" style="margin-top: 12px">
        <em>Noch keine Benachrichtigungen heute</em>
      </p>
      {% endif %}

      <a href="/search" class="quick-action"> üîç Neue Suche starten </a>
    </div>
  </div>

  <!-- Recent Alerts -->
  {% if recent_alerts and recent_alerts|length > 0 %}
  <div class="dashboard-card" style="margin-top: 24px">
    <h3 class="h5 mb-3">üéØ Deine Alerts</h3>

    {% for alert in recent_alerts[:5] %}
    <div class="alert-item">
      <div>
        <div class="alert-term">{{ alert.search_term }}</div>
        <div class="alert-price">
          {{ alert.price_min }}{% if alert.price_max %}-{{ alert.price_max }}{% endif %} EUR ¬∑ {{
          alert.location }} {% if alert.free_shipping %}¬∑ üöö Kostenlos{% endif %}
        </div>
      </div>
      <form method="POST" action="/watchlist/remove/{{ alert.id }}" style="margin: 0">
        <button
          type="submit"
          class="btn btn-sm btn-outline-danger"
          onclick="return confirm('Alert wirklich entfernen?')"
        >
          üóëÔ∏è
        </button>
      </form>
    </div>
    {% endfor %} {% if recent_alerts|length > 5 %}
    <p class="text-center mt-3">
      <a href="/watchlist">+ {{ recent_alerts|length - 5 }} weitere Alerts anzeigen</a>
    </p>
    {% endif %}
  </div>
  {% endif %}

  <!-- Quick Actions -->
  <div class="dashboard-grid" style="margin-top: 24px">
    <a href="/search" class="dashboard-card" style="text-decoration: none; color: inherit">
      <div class="card-title">
        <span class="card-icon">üîç</span>
        Neue Suche
      </div>
      <p class="card-subtitle">Starte eine neue Produktsuche</p>
    </a>

    <a href="/watchlist" class="dashboard-card" style="text-decoration: none; color: inherit">
      <div class="card-title">
        <span class="card-icon">üìã</span>
        Watchlist
      </div>
      <p class="card-subtitle">Alle deine Alerts verwalten</p>
    </a>

    <a href="/pricing" class="dashboard-card" style="text-decoration: none; color: inherit">
      <div class="card-title">
        <span class="card-icon">‚≠ê</span>
        Upgrade
      </div>
      <p class="card-subtitle">Mehr Alerts & schnellere Checks</p>
    </a>
  </div>

  <!-- Stats Footer -->
  <div class="text-center mt-4" style="padding: 24px; background: #f9fafb; border-radius: 12px">
    <p class="text-muted mb-2">
      <strong>Vorteile deines Systems:</strong>
    </p>
    <div style="display: flex; justify-content: center; gap: 32px; flex-wrap: wrap">
      <div>
        <strong style="font-size: 1.5rem; color: #3b82f6">{{ stats.check_interval }} Min</strong
        ><br />
        <small class="text-muted">Check-Interval</small>
      </div>
      <div>
        <strong style="font-size: 1.5rem; color: #10b981">20-30x</strong><br />
        <small class="text-muted">Schneller als eBay</small>
      </div>
      <div>
        <strong style="font-size: 1.5rem; color: #f59e0b">#1-3</strong><br />
        <small class="text-muted">Position bei Kontakt</small>
      </div>
    </div>
  </div>
</div>

{% endblock %}
